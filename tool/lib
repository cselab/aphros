#!/bin/sh

find . -type f -name '*.h' -or -name '*.cpp' | sort |
awk -v me="$0" '
BEGIN {
    print "# generated by " me
    print "add_library(${T} STATIC"
}
{ p = $0
  sub(/^\.\//, "", p)
  if (p ~ /^test\//) next
  if (p == "main.cpp") next
  print p
}
END {
    print "util/gitgen.cpp" # TODO
    print ")"
}
' > lib.cmake
echo >&2 "update lib.cmake"
