#!/bin/bash

set -eu

suff () {
  case $(hostname) in
    daint*) echo _daint ;;
    eu-*) echo _euler ;; 
    falcon*) echo _falcon ;; 
    *) echo ;;
  esac
}

o=out_$(date +%Y-%m-%d_%H%M)$(suff)
> "$o"

a () {
  eval "$@" >> "$o"
}

a 'cat out'
a 'ch.sysinfo'

d=history
mkdir -p "$d"
mv -v "$o" "$d"
