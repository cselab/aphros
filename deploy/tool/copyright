#!/bin/sh

set -eu

if [ "$#" != "1" ] || [ "$1" = "-h" ] ; then
  cat << EOF
usage: $(basename "$0") [-h] FILE
Prints copyright notice for FILE fetching author and date from git index.
EOF
  exit 1
fi


file=$1

list=$(git ls-files -- "$file" )
if [ -z "$list" ] ; then
  echo "File '$file' not found in index" 1>&2
  exit 1
fi

# revision of oldest line
rev=$(git blame -l -e -t -- "$file" | sed -En 's/([0-9a-z]*)[^>]*>\s*([0-9]*).*/\2 \1/p' | sort | awk 'NR==1{print $2}')
git=`git log --date=format:'%d.%m.%Y' "$rev" | head -n3`
author=`echo "$git" | sed -En 's/.*Author: (.*?) <.*/\1/p'`
date=`echo "$git" | sed -En 's/.*Date:   (.*?)/\1/p'`
year=`echo "$date" | sed -En 's/[0-9]*\.[0-9]*\.([0-9]*)/\1/p'`

cat << EOF
// Created by $author on $date
// Copyright $year ETH Zurich
EOF
